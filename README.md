# go-PT 购票系统

## 项目概述
这是一个基于Go语言开发的高并发购票系统，采用Write/Read-Through模式确保数据一致性。

## 缓存架构

### Write/Read-Through模式
本项目采用Write/Read-Through缓存模式，具有以下特点：

1. **数据一致性保证**：写操作同时更新数据库和缓存
2. **同步更新**：确保缓存与数据库状态一致
3. **分布式锁**：防止并发冲突
4. **乐观锁**：数据库层面的并发控制

### 缓存层级
```
本地缓存 (sync.Map) → Redis缓存 → MySQL数据库
```

### 购票流程
1. **获取分布式锁**：防止同一张票被多个用户同时购买
2. **数据库事务**：在事务中执行票务状态更新
3. **同步更新缓存**：同时更新Redis缓存
4. **本地缓存失效**：使本地缓存失效，强制重新加载
5. **消息队列**：异步处理订单

### 缓存管理API

#### 缓存预热
```bash
POST /ticket/cache/warmup
```
系统启动时预加载热门车次数据到缓存

#### 缓存统计
```bash
GET /ticket/cache/stats
```
获取Redis和本地缓存的统计信息

## 技术栈
- **框架**: Gin
- **数据库**: MySQL + GORM
- **缓存**: Redis + 本地缓存(sync.Map)
- **消息队列**: RabbitMQ
- **分布式锁**: Redis实现
- **乐观锁**: 数据库版本控制

## 项目结构
```
12305/
├── api/           # API接口层
├── conf/          # 配置文件
├── config/        # 配置管理
├── db/            # 数据库连接
├── enum/          # 枚举定义
├── middleware/    # 中间件
├── model/         # 数据模型
├── mq/            # 消息队列
├── repository/    # 数据访问层
├── response/      # 响应结构
├── service/       # 业务逻辑层
└── utils/         # 工具函数
```

## 启动说明
1. 确保MySQL、Redis、RabbitMQ服务已启动
2. 修改`conf/conf.yaml`中的数据库配置
3. 运行`go run main.go`
4. 访问`http://localhost:8080`

## 缓存策略优势
- **强一致性**：Write/Read-Through模式确保数据一致性
- **高性能**：多级缓存减少数据库访问
- **高可用**：分布式锁防止超卖
- **可监控**：提供缓存统计接口

防穿透		布隆过滤器 + 空值缓存
防击穿		互斥锁 + 分布式锁
防雪崩		随机过期 + 限流
限流保护		令牌桶算法